# 差分

## 什么是差分？

差分是前缀和的逆运算

$存在一个数列: a_1\ a_2\ a_3\ …… \ a_n$

$构造b_1\ b_2\ …… \ b_n$

使得$a_i = b_1\ + b_2\ +……+\ b_n$

即a[]数组是b[]数组的前缀和

​    b[]数组是a[]数组的差分

**一维差分数组的构造：**

$b_1 = a_1$

$b_2 = a_2-a_1$

$b_3 = a_3-a_2$

……

$b_i = a_i-a_{i-1}$

左边相加 => $b_1\ + b_2\ +……+\ b_n$

右边相加 => $a_i$

## 差分的作用

有了b[]数组，就可以在o(n)的时间内得到a[]数组

**作用：**

将区间[l, r]之间的数，全部加c(常数)

![image-20221028212246634](https://cdn.jsdelivr.net/gh/Lx001T/my-imgs/jq2022/image-20221028212246634.png)

这个操作如果用**暴力**做法，循环一遍再全部**+c**，时间复杂度是**o(n)**。但是用**差分**，时间复杂度是**o(1)**

**用法：**

由上述一维差分数组的构造可知，如果将$b_l + c$，则得到的$a_l$也会+c

同时$a_{l+1}\\ a_{l+2} \\ …… \\ a_n \\ 都会+C$

但是因为只需要将[l, r]区间内的所有数+c即可，r之后的数不需要+c

所以还需要将$b_{r+1}-c$即可，这样$a_{r+1}$之后的数全都会 -c，和之前的+c抵消。

最后得到的效果就是将[l, r]区间内的数全都+c

![image-20221028213952034](https://cdn.jsdelivr.net/gh/Lx001T/my-imgs/jq2022/image-20221028213952034.png)

## 差分的实现

这里的数组a[]有一个特殊的构造方式：

假定数组a[]初始全部是0，这样差分数组也全是0

在区间[1,1]中插入a1

在区间[2,2]中插入a2

……

在区间[n, n]中插入an

![image-20221028214826866](https://cdn.jsdelivr.net/gh/Lx001T/my-imgs/jq2022/image-20221028214826866.png)

这里的+c操作和差分时的+c操作一样。

所以整个差分只有一种操作，如果向在区间[l,r]所有数+c的话，只要将$b_l+c\ \ b_{r+1}-c$即可

# 本题解析

## 题目描述

输入一个长度为 n 的整数序列。

接下来输入 m 个操作，每个操作包含三个整数 l,r,c表示将序列中 [l,r][l,r] 之间的每个数加上 c。

请你输出进行完所有操作后的序列。

输入格式

第一行包含两个整数 n 和 m。

第二行包含 n 个整数，表示整数序列。

接下来 m 行，每行包含三个整数 l，r，c表示一个操作。

输出格式

共一行，包含 n 个整数，表示最终序列。

数据范围

1≤n,m≤100000
1≤l≤r≤n
−1000≤c≤1000
−1000≤整数序列中元素的值≤1000

输入样例：

```
6 3
1 2 2 1 2 1
1 3 1
3 5 1
1 6 1
```

输出样例：

```
3 4 5 3 4 2
```

## C++代码

```C++
#include <iostream>

using namespace std;

const int N = 100010;

int n, m;
int a[N], b[N];

void insert(int l, int r, int c)
{
    b[l] += c;
    b[r + 1] -= c;
}

int main()
{
    cin >> n >> m;
    
    for (int i = 1; i <= n; i ++ ) cin >> a[i];
    
    for (int i = 1; i <= n; i ++ ) insert(i, i, a[i]);
    
    while (m -- )
    {
        int l, r, c;
        cin >> l >> r >> c;
        insert(l, r, c);
    }
    
    for (int i = 1; i <= n; i ++ ) b[i] += b[i - 1];
    
    for (int i = 1; i <= n; i ++ ) cout << b[i] << ' ';
    
    return 0;
}
```

## 代码解析

```C++
// 实现差分，实现+c
void insert(int l, int r, int c)
{
    b[l] += c;
    b[r + 1] -= c;
}
```

```C++
for (int i = 1; i <= n; i ++ ) cin >> a[i]; // 输入数组a[]的值
    
for (int i = 1; i <= n; i ++ ) insert(i, i, a[i]); // 实现差分，调用了insert函数，相当于b[i] += a[i], b[i + 1] -= a[i]
// 因为b[i + 1] = a[i + 1] - a[i]
```

实例：

![image-20221028222716602](https://cdn.jsdelivr.net/gh/Lx001T/my-imgs/jq2022/image-20221028222716602.png)

```C++
// 处理+c操作
while (m -- )
{
    int l, r, c;
    cin >> l >> r >> c;
    insert(l, r, c);
}
```

```C++
// 用差分求前缀和
for (int i = 1; i <= n; i ++ ) b[i] += b[i - 1];
```

```C++
// 输出求了前缀和的数组
for (int i = 1; i <= n; i ++ ) cout << b[i] << ' ';
```

